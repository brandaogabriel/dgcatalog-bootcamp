# üíª Back end Dg Catalog
[![Build Status](https://travis-ci.org/brandaogabriel/dgcatalog-bootcamp.svg?branch=main)](https://travis-ci.org/brandaogabriel/dgcatalog-bootcamp)

A api foi desenvolvida durante o bootcamp realizado na DevSuperior.

A implanta√ß√£o da api foi feita utilizando o heroku.

**Aten√ß√£o**: Voc√™ precisa ter o java jdk 11 instalado na sua m√°quina bem como o `PATH_VARIABLE` do
java configurado e uma IDE de sua prefer√™ncia.

## üîå Configura√ß√µes para inicializa√ß√£o

- **O backend est√° setado em modo de PRODU√á√ÉO, acesse `src/main/resources/application.properties` e
  troque `spring.profiles.active=prod` por `spring.profiles.active=test`. Com essa mudan√ßa, ser√°
  utilizado o banco de dados em mem√≥ria (H2).**
- **O sistema utiliza o servi√ßo da AWS de armazenamento de arquivos, S3, dessa forma √© necess√°rio
  que voc√™ crie um "bucket" bem como configure as credenciais que est√£o definidas em
  `main/resources/application.properties`.**
  ````
  aws.access_key_id=SUA_CHAVE_DE_ACESSO
  aws.secret_access_key=SUA_AWS_SECRET_KEY
  s3.bucket=NOME_DO_BUCKET
  s3.region=REGIAO_DO_BUCKET

Execute o comando: `mvn install` para instalar as depend√™ncias do maven.

Ap√≥s baixar as depend√™ncias, execute a aplica√ß√£o e a api estar√° rodando em http://localhost:8080.

Acesso ao banco de dados: `http://localhost:8080/h2-console`.

## üó∫Ô∏è Diagrama de Classes - Modelo de Dom√≠nio

![diagrama](images/diagrama.png)

## üßæ Documenta√ß√£o

A documenta√ß√£o da api foi gerada atrav√©s do Swagger e pode ser acessada
em `http://localhost:8080/swagger-ui.html#`

## üìå Endpoints

Os seguintes endpoints est√£o configurados:

**ATEN√á√ÉO:**

- `/h2-console`
- `/swagger-ui.html#`
- [GET] `/products`
- [GET]`/products/{id}`
- [GET] `/categories`
- [GET] `/categories/{id}`
- [POST] `/oauth/token`

Est√£o **liberadas** para acesso **sem autentica√ß√£o**. Caso queira acessar as **demais** rotas √©
necess√°rio **realizar autentica√ß√£o** no sistema.

### Auth

- `/oauth/token` - POST - Realiza o login do usu√°rio na aplica√ß√£o.

**OBS¬π:** No momento de fazer a requisi√ß√£o, configure a "Authorizaiton" como `Basic Auth` e repasse
o `username=dgcatalog` e a `password=dgcatalog123`.

**OBS¬≤:** O corpo da requisi√ß√£o deve ser do tipo `x-www-form-urlencoded`, crie os campos "username",
"password" e "grant_type".

- Em "username", coloque seu valor como `maria@gmail.com`.
- Em "password", coloque seu valor como `123456`.
- Em "grant_type", coloque seu valor como `password`. (Isso indica o m√©todo de autentica√ß√£o do
  sistema).

**OBS¬≥:** O usu√°rio "maria" √© super-usu√°rio da aplica√ß√£o, dessa forma tem acesso a todas as rotas.
Caso queira ver outros usu√°rio veja o arquivo em `src/main/resources/data.sql`.

### Users

**APENAS ADMINISTRADORES PODEM ACESSAR AS ROTAS**

- `/users` - GET - Exibe todos os usu√°rios paginados cadastrados na API em ordem alfab√©tica (nome do
  usu√°rio).
- `/users/{id}` - GET - Exibe as informa√ß√µes de um usu√°rio espec√≠fico bem como quais s√£o suas
  "roles".
- `/users` - POST - Cria um usu√°rio.
- `/users/{id}` - PUT - Atualiza as informa√ß√µes de um usu√°rio espec√≠fico.
- `/users/{id}` - DELETE - Remove um usu√°rio espec√≠fico.

**Exemplo de dados para criar um Usu√°rio (JSON)**

```json
{
  "firstName": "any_name",
  "lastName": "any_lastName",
  "email": "any_email@gmail.com",
  "password": "any_password",
  "roles": [
    {
      "id": 1
    },
    {
      "id": 2
    }
  ]
}
```

**Exemplo de dados para atualizar um Usu√°rio (JSON)**

```json
{
  "firstName": "any_name_edit",
  "lastName": "any_lastName_edit",
  "email": "any_email_edit@gmail.com",
  "roles": [
    {
      "id": 1
    }
  ]
}
```

### Products

- `/products` - GET - Exibe todos os produtos paginados cadastrados na API em ordem alfab√©tica
  (nome do produto).
- `/products/{id}` - GET - Exibe as informa√ß√µes de um produto espec√≠fico bem como quais s√£o suas
  "categories".
- `/products` - POST - Cria um produto. **AUTENTICA√á√ÉO COMO OPERATOR OU ADMIN NECESS√ÅRIA**
- `/products/{id}` - PUT - Atualiza as informa√ß√µes de um produto espec√≠fico. **AUTENTICA√á√ÉO COMO
  OPERATOR OU ADMIN NECESS√ÅRIA**
- `/products/{id}` - DELETE - Remove um produto espec√≠fico. **AUTENTICA√á√ÉO COMO OPERATOR OU ADMIN
  NECESS√ÅRIA**
- `/products/image` - POST - Insere a imagem no AWS S3. √â necess√°rio que o corpo da requisi√ß√£o seja
  do tipo `form-data` com a chave `file`. **AUTENTICA√á√ÉO COMO OPERATOR OU ADMIN
  NECESS√ÅRIA**

**Exemplo de dados para criar um Produto (JSON)**

```json
{
  "date": "2020-01-14T15:00:00Z",
  "description": "any_description",
  "name": "any_name",
  "imgUrl": "",
  "price": 600.00,
  "categories": [
    {
      "id": 1
    },
    {
      "id": 3
    }
  ]
}
```

**Exemplo de dados para atualizar um Produto (JSON)**

```json
{
  "date": "2020-01-14T17:00:00Z",
  "description": "any_description_edit",
  "name": "any_name_Edit",
  "imgUrl": "",
  "price": 1000.00,
  "categories": [
    {
      "id": 2
    }
  ]
}
```

### Categories

- `/categories` - GET - Exibe todos as categorias paginadas cadastradas na API em ordem alfab√©tica
  (nome da categoria).
- `/categories/{id}` - GET - Exibe as informa√ß√µes de uma categoria espec√≠fica.
- `/categories` - POST - Cria uma categoria. **AUTENTICA√á√ÉO COMO OPERATOR OU ADMIN NECESS√ÅRIA**
- `/categories/{id}` - PUT - Atualiza as informa√ß√µes de uma categoria. **AUTENTICA√á√ÉO COMO OPERATOR
  OU ADMIN NECESS√ÅRIA**
- `/categories/{id}` - DELETE - Remove uma categoria espec√≠fica. **AUTENTICA√á√ÉO COMO OPERATOR OU
  ADMIN NECESS√ÅRIA**

**Exemplo de dados para criar uma Categoria (JSON)**

```json
{
  "name": "any_name"
}
```

**Exemplo de dados para atualizar uma Categoria (JSON)**

```json
{
  "name": "any_name_edit"
}
```

## üõ†Ô∏è Ferramentas

1. Java
2. Springboot
3. Spring Data JPA
4. Spring Validation
5. Spring Cloud
6. Spring Security
7. Spring Security Oauth2
8. AWS Java JDK (Para utilizar o servi√ßo S3)
8. Swagger (Documenta√ß√£o)
9. H2 database
10. postgresql

## üíæ Dados para povoar a api

Na pasta `src/main/resources` existe um arquivo **data.sql** com alguns dados j√° adicionados, para
inserir novos dados, basta inclu√≠-los no arquivo. 